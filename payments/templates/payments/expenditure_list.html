{% extends "cores/base1.html" %}
{% block content %}

<div class="container mt-4">

    <!-- Header + Create Button -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="mb-0">Expenditures</h3>
        <a href="{% url 'payments:expcreate' %}" class="btn btn-success">
            <i class="bi bi-plus-circle"></i> Create Expenditure
        </a>
    </div>

    <!-- Filter Form -->
    <form method="GET" class="row g-3 mb-4">
        <div class="col-md-3">
            <label for="filter_type" class="form-label">Filter By</label>
            <select name="filter_type" id="filter_type" class="form-select">
                <option value="today" {% if request.GET.filter_type == "today" %}selected{% endif %}>Today</option>
                <option value="month" {% if request.GET.filter_type == "month" %}selected{% endif %}>Month</option>
            </select>
        </div>

        <div class="col-md-3" id="month_select" {% if request.GET.filter_type != "month" %}style="display:none;"{% endif %}>
            <label for="month" class="form-label">Month</label>
            <select name="month" id="month" class="form-select">
                {% for num, name in months %}
                <option value="{{ num }}" {% if request.GET.month == num|stringformat:"s" %}selected{% endif %}>{{ name }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="col-md-3 align-self-end">
            <button type="submit" class="btn btn-primary">Filter</button>
        </div>
    </form>

    <!-- Totals -->
    <div class="mb-3">
        <strong>Total Expenditure:</strong> {{ total_amount }} TZS
    </div>

    <!-- Table -->
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th>Date</th>
                <th>Title</th>
                <th>Amount (TZS)</th>
            </tr>
        </thead>
        <tbody>
            {% for e in expenditures %}
            <tr>
                <td>{{ e.date }}</td>
                <td>{{ e.title }}</td>
                <td>{{ e.amount }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="3" class="text-center text-muted">No records found.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

</div>

<script>
    const filterType = document.getElementById('filter_type');
    const monthSelect = document.getElementById('month_select');

    filterType.addEventListener('change', function() {
        if (this.value === 'month') {
            monthSelect.style.display = 'block';
        } else {
            monthSelect.style.display = 'none';
        }
    });
</script>

{% endblock %}
